RewriteEngine on

# Enforce non-www URLs
RewriteCond %{HTTP_HOST} ^www\.artinruins\.com [NC]
RewriteRule ^(.*)$ https://artinruins.com/$1 [L,R=301]

# Enforce HTTPS
RewriteCond %{HTTP_HOST} artinruins\.com [NC]
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://artinruins.com/$1 [R,L]

# Custom 404
ErrorDocument 404 /404.html

RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https://artinruins.com/.*$      [NC]
RewriteCond %{HTTP_REFERER} !^https://artinruins.com$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://community.artinruins.com/.*$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://community.artinruins.com$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://defunctnewengland.artinruins.com/.*$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://defunctnewengland.artinruins.com$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://jenraimondi.artinruins.com/.*$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://jenraimondi.artinruins.com$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://mayyao.artinruins.com/.*$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://mayyao.artinruins.com$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://quonsetpoint.artinruins.com/.*$      [NC]
#RewriteCond %{HTTP_REFERER} !^http://quonsetpoint.artinruins.com$      [NC]


# Manual redirects
# redirect 301 /path/to/old-file.php   http://domain.tld/path/to/new-file.php

redirect 301 /contact.php                      https://artinruins.com/

redirect 301 /merch/index.php                  https://artinruins.com/support/

redirect 301 /stories/index.php                https://artinruins.com/
redirect 301 /stories/sounds.php               https://artinruins.com/
redirect 301 /stories/rumors_archive.php       https://artinruins.com/
redirect 301 /stories/rumors_archive2007.php   https://artinruins.com/
redirect 301 /stories/rumors_archive2008.php   https://artinruins.com/
redirect 301 /stories/essays/index.php         https://artinruins.com/

RedirectMatch 301 ^/interviews/.*$             https://artinruins.com/

redirect 301 /links/advocacy.php               https://artinruins.com/links/
redirect 301 /links/arts.php                   https://artinruins.com/links/
redirect 301 /links/beyond.php                 https://artinruins.com/links/
redirect 301 /links/forrent.php                https://artinruins.com/links/
redirect 301 /links/other.php                  https://artinruins.com/links/
redirect 301 /links/preservation.php           https://artinruins.com/links/
redirect 301 /links/venues.php                 https://artinruins.com/links/

# Individual redirects from Backlink checkers
redirect 301 /arch/saved/provworst/*           https://artinruins.com/property/national-providence-worsted/
redirect 301 /arch/redevelop/mason/*           https://artinruins.com/property/masonic-temple-pvd/
redirect 301 /arch/stillinuse/unionstation/*   https://artinruins.com/property/union-station/
redirect 301 /arch/historical/postcards/*      https://artinruins.com/property/postcards-pvd/

# Cache rules from https://gist.github.com/esedic/4d1f230e94e3309f36cec3eb1a6bc812
## BEGIN EXPIRES CACHING ##
<IfModule mod_expires.c>
  ExpiresActive on

  # Perhaps better to whitelist expires rules? Perhaps.
  ExpiresDefault "access plus 1 year"

  # cache.appcache needs re-requests in FF 3.6 (thanks Remy ~Introducing HTML5)
  ExpiresByType text/cache-manifest "access plus 0 seconds"

  # Your document html
  ExpiresByType text/html "access plus 0 seconds"

  # Data
  ExpiresByType text/xml "access plus 0 seconds"
  ExpiresByType application/xml "access plus 0 seconds"
  ExpiresByType application/json "access plus 0 seconds"

  # Feed
  ExpiresByType application/rss+xml "access plus 1 hour"
  ExpiresByType application/atom+xml "access plus 1 hour"

  # Favicon (cannot be renamed)
  ExpiresByType image/x-icon "access plus 1 month"
  ExpiresByType image/vnd.microsoft.icon "access plus 1 month"

  # Media: images, video, audio
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/avif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType audio/ogg "access plus 1 year"
  ExpiresByType audio/mpeg "access plus 1 year"
  ExpiresByType video/ogg "access plus 1 year"
  ExpiresByType video/mp4 "access plus 1 year"
  ExpiresByType video/webm "access plus 1 year"

  # HTC files (css3pie)
  ExpiresByType text/x-component "access plus 1 year"

  # Webfonts
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-ttf "access plus 1 year"
  ExpiresByType application/font-otf "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
  ExpiresByType application/x-font-ttf "access plus 1 year"
  ExpiresByType application/x-font-woff "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"

  # CSS and JavaScript
  ExpiresByType text/css "access plus 6 months"
  ExpiresByType text/javascript "access plus 6 months"
  ExpiresByType application/javascript "access plus 6 months"
  ExpiresByType application/x-javascript "access plus 6 months"

  <IfModule mod_headers.c>
    Header append Cache-Control "public"
    <FilesMatch "\.(js|css|xml|gz|html)$">
      Header append Vary: Accept-Encoding
    </FilesMatch>
  </IfModule>

</IfModule>
## END EXPIRES CACHING ##

## BEGIN COMPRESSION ##
# Gzip compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/font
  AddOutputFilterByType DEFLATE application/font-truetype
  AddOutputFilterByType DEFLATE application/font-ttf
  AddOutputFilterByType DEFLATE application/font-otf
  AddOutputFilterByType DEFLATE application/font-opentype
  AddOutputFilterByType DEFLATE application/font-woff
  AddOutputFilterByType DEFLATE application/font-woff2
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/woff
  AddOutputFilterByType DEFLATE font/woff2
</IfModule>

# Brotli compression (if available, typically Apache 2.4.26+)
<IfModule mod_brotli.c>
  AddOutputFilterByType BROTLI_COMPRESS text/html
  AddOutputFilterByType BROTLI_COMPRESS text/css
  AddOutputFilterByType BROTLI_COMPRESS text/javascript
  AddOutputFilterByType BROTLI_COMPRESS text/xml
  AddOutputFilterByType BROTLI_COMPRESS text/plain
  AddOutputFilterByType BROTLI_COMPRESS image/svg+xml
  AddOutputFilterByType BROTLI_COMPRESS application/javascript
  AddOutputFilterByType BROTLI_COMPRESS application/x-javascript
  AddOutputFilterByType BROTLI_COMPRESS application/xml
  AddOutputFilterByType BROTLI_COMPRESS application/xhtml+xml
  AddOutputFilterByType BROTLI_COMPRESS application/json
  AddOutputFilterByType BROTLI_COMPRESS application/rss+xml
  AddOutputFilterByType BROTLI_COMPRESS application/font-woff
  AddOutputFilterByType BROTLI_COMPRESS application/font-woff2
  AddOutputFilterByType BROTLI_COMPRESS font/woff
  AddOutputFilterByType BROTLI_COMPRESS font/woff2
</IfModule>
## END COMPRESSION ##

## BEGIN SECURITY HEADERS ##
<IfModule mod_headers.c>
  # Prevent MIME type sniffing
  Header always set X-Content-Type-Options "nosniff"

  # Prevent clickjacking
  Header always set X-Frame-Options "SAMEORIGIN"

  # Referrer policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"

  # Remove server signature
  Header always unset X-Powered-By
  Header unset X-Powered-By
</IfModule>
## END SECURITY HEADERS ##
